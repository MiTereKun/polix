<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Цены 7 фев</title>
	<style>
		body{font-family:Arial,sans-serif;margin:10px 10px 10px 10px;padding:10px;border:1px solid #ccc;border-radius:8px;max-width:280px;background-color:white;color:black;margin-top:8px}.question{margin-bottom:20px}.result{font-weight:bold;margin-top:15px}@media (prefers-color-scheme: dark){body{background-color:#333;color:white;border-color:#555}}@media (max-width:276px){body{font-size:13px}}@media (min-width:550px){body{margin:10px 10px 10px 10px;margin-top:8px}}@media (max-width:550px){body{margin:10px auto 10px auto}}
		.back-button{display:block;margin:8px auto 0;color:#007BFF;text-decoration:underline;cursor:pointer;text-align:center;}
		.back-button2{display:block;color:#007BFF;text-decoration:underline;cursor:pointer}
		.back-button2:hover{color:#0056b3;}
		.back-button:hover{color:#0056b3;}
		footer { position: relative; top: 4px; text-align: center; color: gray; font-size: 12px;}
		label img { filter: drop-shadow(0 0 5px white); }
		
		.tooltip, .tooltip-motivation { position: absolute; background: #f0f0f0; color: black; padding: 8px 16px; border-radius: 4px; font-size: 14px; opacity: 0; visibility: hidden; transition: opacity 0.5s, visibility 0.5s; z-index: 1000; border: 1px solid #ccc; white-space: pre-line; user-select: none; cursor: default; }
		@media (prefers-color-scheme: dark) { .tooltip, .tooltip-motivation { background: #404040; color: white; border: 1px solid #555; } }
		.tooltip.show, .tooltip-motivation.show { opacity: 1; visibility: visible; }
		#tooltip2 { position: absolute; background: #f0f0f0; color: black; border-radius: 4px; border: 1px solid #ccc; padding: 6px 8px; z-index: 1000; opacity: 0; visibility: hidden; transition: opacity 0.5s, visibility 0.5s; user-select: none; cursor: default; }
		@media (prefers-color-scheme: dark) { #tooltip2 { background: #404040; color: white; border: 1px solid #555; } }
		#tooltip2.show { opacity: 1; visibility: visible; }
		#tooltip2 p { margin: 7px 0; }
		
		.spoiler{margin:8px 0 0;padding:0;width:100%}
		.spoiler-header{display:flex;justify-content:space-between;align-items:center;cursor:pointer;font-weight:700;color:#333;padding:8px;background:#eaeaea;border-radius:4px;margin-bottom:0px}
		.spoiler-content{max-height:0;overflow:hidden;transition:max-height .2s ease-out;padding:0;width:100%;margin:0}
		.spoiler-footer{text-align:right;font-size:.9em;color:#666;opacity:0;transition:opacity .2s ease-out;margin:0;cursor:pointer}
		.spoiler-footer.show{opacity:1; padding-bottom: 10px;}
		.spoiler-icon{font-size:1.2em;margin-left:auto;transition: transform .2s ease}
		.spoiler-icon.rotate {transform: rotate(180deg);}
		@media (prefers-color-scheme: dark){ .spoiler-header{background:#555;color:#eee} .spoiler-footer{color:#aaa } }
		.price{float:right;position:relative;top:8px;white-space:nowrap}
		.price2{float:right;position:relative;top:0px;white-space:nowrap}
		.price3{float:right;position:relative;top:-16px;white-space:nowrap}
		.smile{font-size: 13px;}

	</style>
</head>
<body>

<div id="tooltip2">
    <p>Кол: 
        <button class="button" onclick="decreaseQuantity()">-</button>
        <span id="quantityDisplay2">1</span> 
        <button class="button" onclick="increaseQuantity()">+</button>
    </p>
    <p>Цена: <span id="costDisplay2">0</span></p>
    <button class="button confirm-button" onclick="confirmSelection2()">Закрыть окно</button>
</div>

<div id="tooltip" class="tooltip"></div>
<div id="tooltip-motivation" class="tooltip-motivation"></div>
<div id="tooltipOk" class="tooltip"></div>
<div id="tooltip-price" class="tooltip"></div>

<div class="question">
    <label>Выберите тариф:</label><br>
    <input type="radio" name="tariff" value="850" id="tariff1" data-discount="0" data-discount2="850" checked>
    <label for="tariff1">1&#160&#160&#160&#160: 650 мин, 30 Гб, 100 SMS</label><br>
	
	<input type="radio" name="tariff" value="890" id="tariff112" data-discount="13" data-discount2="712">
    <label for="tariff112">112: 650 мин, 30 Гб, 100 SMS</label><br>
	
	<input type="radio" name="tariff" value="1050" id="tariff7" data-discount="0" data-discount2="1050">
    <label for="tariff7">7&#160&#160&#160&#160: 1200 мин, 50 Гб, 50 SMS</label><br>
    
    <input type="radio" name="tariff" value="650" id="tariff3" data-discount="0" data-discount2="650">
    <label for="tariff3">3&#160&#160: 0 мин, 1 раз 30 Гб, 0 SMS</label><br>
</div>

<div class="question">
    <label>Покупки&#160&#160&#160&#160 и &#160&#160&#160&#160&#160 Рассрочки:</label><br>
    
    <input type="checkbox" name="buyRouter" value="1700" id="buyRouterYes" data-installments="0" data-installments2="300">
	<label for="buyRouterYes">Б/У&#160&#160&#160<img alt="" width="30" height="30" src="https://i124.fastpic.org/big/2025/0206/e1/73c9fb5060d3522edc1d5091817bd6e1.png"> <small>5G - 1700</small></label> <input type="checkbox" name="Router" value="100" id="router" data-installments="2"><label for="router"><small>100</small></label><br>
	<input type="checkbox" name="buyBox" value="5000" id="buyBoxYes2" data-installments="0" data-installments2="500" onclick="checkCheckboxes2(event, 'buyBoxYes2')" style="margin-bottom: 15px;"><label for="buyBoxYes2"> НОВ  <img alt="" width="30" height="19" src="https://i124.fastpic.org/big/2025/0206/81/2705875bd97b99af94b0e0d395d0a181.png ">&#160&#160&#160&#160&#160<small> - 5000</small></label> <input type="checkbox" name="buyBox3" value="250" id="buyBoxYes3" data-installments="2" data-installments2="500" onclick="checkCheckboxes2(event, 'buyBoxYes3')"><label for="buyBoxYes3"><small>250</small></label><br>
	<label>Пришли &#160&#160&#160 в &nbsp&#160&#160&#160&#160&#160 феврале:</label><br>
	<input type="checkbox" name="buyRouter2" value="3600" id="buyRouterYes2" data-installments="0" data-installments2="500">
	<label for="buyRouterYes2">НОВ <img alt="" style="width: 41px;padding-left: 0px;border-left-width: 0px;border-left-style: solid;margin-left: -6px;padding-right: 0px;margin-right: -6px;" src="https://i124.fastpic.org/big/2025/0206/63/89b76a861fdae09163b87c9e3701a563.png"> <small>5G - 3600</small></label>
	<input type="checkbox" name="WiFi6" value="100" id="WiFi6_1" data-installments="3"><label for="WiFi6_1"><small>100</small></label>
	<input type="checkbox" name="WiFi6" value="295" id="WiFi6_2" data-installments="1" data-installments2="500"><label for="WiFi6_2"><small>295</small></label><br>
	<input type="checkbox" name="buyBox" value="1999" id="buyBoxYes" data-installments="0" data-installments2="300" onclick="checkCheckboxes2(event, 'buyBoxYes')">
	<label for="buyBoxYes">Б/У&#160&#160&#160<img src="https://i124.fastpic.org/big/2025/0206/81/2705875bd97b99af94b0e0d395d0a181.png" alt="" width="30" height="19"> <small style="padding-right: 0px;padding-left: 20px;">- 1999</small></label> <input type="checkbox" name="WiFi6" value="100" id="buyBoxYes4" data-installments="2" data-installments2="300" onclick="checkCheckboxes2(event, 'buyBoxYes4')"><label for="buyBoxYes4"><small>100</small></label>
</div>

<div class="spoiler">
    <div class="spoiler-header" onclick="toggleSpoiler(this)">
        <span>Дополнительно</span>
        <span class="spoiler-icon">+</span>
    </div>
		<div class="spoiler-content"><br>
			<label>Роутер не на складе:</label><br>
			<input type="checkbox" name="buyRouter3" value="5400" id="buyRouterYes3" data-installments2="500">
			<label for="buyRouterYes3">НОВ <img src="https://i124.fastpic.org/big/2025/0206/e1/73c9fb5060d3522edc1d5091817bd6e1.png" alt="" width="30" height="30"> <small>6G - 5400</small></label>&#160<input type="checkbox" name="WiFi6" value="450" id="WiFi6" data-installments="1" data-installments2="500"><label for="WiFi6"><small>450</small></label>
			<br><br><label>Услуги:</label><br><br>
			<input type="checkbox" name="RouterSetup" value="200" id="RouterSetup" style="margin-top: 0px;"><label for="RouterSetup">Настройка роутера - 200</label><br>
			<br><label>Тарифы для сервисов:</label><br><br>
			<input type="radio" name="tariff" value="950" id="tariff2" data-discount="12" data-discount2="780">
			<label for="tariff2">2: 500 мин, 35 Гб, 100 SMS</label><br>
			<input type="radio" name="tariff" value="1090" id="tariff4" data-discount="12" data-discount2="950" style="margin-bottom: 15px;">
			<label for="tariff4">4: 1200 мин, 50 Гб, 50 SMS</label>
	</div>
	<div class="spoiler-footer" onclick="toggleSpoiler(this.parentElement.querySelector('.spoiler-header'))">
        [свернуть]
    </div>
	
</div>

<div class="question">
    <label>Семья <small>: 1 раз 100 + 450 за человека</small></label>
	<br>
    <input type="radio" name="family" value="0" id="family0" checked style="margin-top: 8px">
    <label for="family0">0</label>
    <input type="radio" name="family" value="450" id="family1">
    <label for="family1">1</label>
    <input type="radio" name="family" value="900" id="family2">
    <label for="family2">2</label>
    <input type="radio" name="family" value="1350" id="family3">
    <label for="family3">3</label>
    <input type="radio" name="family" value="1800" id="family4">
    <label for="family4">4</label><br>
	<input type="checkbox" name="MNP" value="200" id="MNP" style="margin-top: 12px;margin-bottom: 0px;"><label for="MNP"><small>MNP - скидка 50% на 4 м</small></label>
</div>

<div class='result'>
	<hr>
    <h3>1 оплата : <span id='OneFinalPrice'>0</span> руб</h3>
    <h3><a style="padding-right: 8px;">в месяц</a> : <span id='finalPrice'>0</span> руб</h3>
    <h3><span id='discountEndDate'></span><span id='totalPrice'>0</span></h3>
	<h3><span id="installmentsResult"></span></h3>
</div>

<hr>
<div class="back-button"onclick="window.location.href='https://polix.pro/FullTarif'">Открыть таблицу тарифов</div>
<div class="back-button"onclick="window.location.href='https://urmdf.ssl.mts.ru/orders'">Открыть дилерский портал</div><hr>

<div class="spoiler">
    <div class="spoiler-header" onclick="toggleSpoiler(this)" style="margin-top: 17px;">
        <span>Сервисы Зелёная точка</span>
        <span class="spoiler-icon">+</span>
    </div>
		<div class="spoiler-content">
			<div class="question">
				<small>
					<input type="checkbox" name="serviceRouterBuy" value="2200" id="serviceRouterBuy" onclick="checkCheckboxes2(event, 'serviceRouterBuy')" style="margin-top: 10px;">
					<label for="serviceRouterBuy">Покупка роутера б/у 5 Ггц<span class="price" style="top: 11px;">- 2200</span></label>
				</small><br>

				<small>
					<input type="checkbox" name="serviceSetTopBoxBuy" value="4300" id="serviceSetTopBoxBuy" onclick="checkCheckboxes2(event, 'serviceSetTopBoxBuy')">
					<label for="serviceSetTopBoxBuy">Покупка приставки зефир<span class="price">- 4300</span></label>
				</small><br>
			</div>

			<div class='result'>
				<h3><span id="ServisPrise2"></span></h3>
			</div>

			<div class="question">
				<small>
					<input type="checkbox" name="serviceRouterRent" value="120" id="serviceRouterRent" onclick="checkCheckboxes2(event, 'serviceRouterRent')">
					<label for="serviceRouterRent">Аренда роутера / Приставки<span class="price">- 120</span></label>
				</small><br>
					<div class='result'>
						<h3><span id="ServisPrise4"></span></h3>
					</div>
				<small>
					<input type="checkbox" name="serviceDeviceInstall" value="300" id="serviceDeviceInstall" onclick="checkCheckboxes2(event, 'serviceDeviceInstall')">
					<label for="serviceDeviceInstall">Уст дополнительных устройств<span class="price">- 300</span></label>
				</small><br>

				<small>
					<input type="checkbox" name="serviceRemoteReplace" value="800" id="serviceRemoteReplace" onclick="checkCheckboxes2(event, 'serviceRemoteReplace')">
					<label for="serviceRemoteReplace">Замена пульта, блока питания<span class="price">- 800</span></label>
				</small><br>

				<small>
					<input type="checkbox" name="serviceEquipmentReplace" value="400" id="serviceEquipmentReplace" onclick="checkCheckboxes2(event, 'serviceEquipmentReplace')">
					<label for="serviceEquipmentReplace">Замена оборудки и комплект<span class="price">- 400</span></label>
				</small><br>

				<small>
					<input type="checkbox" name="serviceCableInstall" value="400" id="serviceCableInstall" onclick="checkCheckboxes2(event, 'serviceCableInstall')">
					<label for="serviceCableInstall">Прокладка кабеля по плинтусу<span class="price">- 400</span></label>
				</small>
			</div>

			<div class='result'>
				<h3><span id="ServisPrise"></span></h3>
				<h3><span id="ServisPrise3"></span></h3>
			</div>
		</div>
    <div class="spoiler-footer" onclick="toggleSpoiler(this.parentElement.querySelector('.spoiler-header'))">
        [свернуть]
    </div>
</div>

<div class="spoiler">
    <div class="spoiler-header" onclick="toggleSpoiler(this)">
        <span>Справка для СИ</span>
        <span class="spoiler-icon">+</span>
    </div>
		<div class="spoiler-content">
			<div class="smile">
				<p>Дабл (интернет и IPTV) <span class="price2">- 2017</span></p>
				<p>ШПД FTTB (только интернет) <span class="price2">- 1829</span></p>
				<p>Привлечение из ЗТ в МТС <span class="price2">- 1200</span></p>
				<p>Гарантия у нов оборудования <span class="price2">- год</span></p>
				<p>Гарантия у б/у оборудования <span class="price2">- пол года</span></p>
				<a class="back-button2" href="tel:+79167618888">+79167618888</a><span class="price3">- поддержка систем МТС</span><br>
			</div>
	</div>
	<div class="spoiler-footer" onclick="toggleSpoiler(this.parentElement.querySelector('.spoiler-header'))">
        [свернуть]
    </div>
	
</div>

<footer>
	<small>Об ошибках сообщайте <a href="https://mi_0014.t.me" target="_blank" style="color: #6C8EBF;">@mi_0014</a>.</small>
</footer>

<script>
let quantities = {
    buyBoxYes2: 0,
    buyBoxYes3: 0,
    buyBoxYes: 0,
    buyBoxYes4: 0,
	serviceDeviceInstall: 1,
	serviceRouterRent: 1,
	serviceRemoteReplace: 1,
	serviceEquipmentReplace: 1,
	serviceCableInstall: 1,
	serviceRouterBuy: 1,
	serviceSetTopBoxBuy: 1
};

function calculateTotal() {
    const tariff = parseFloat(document.querySelector('input[name=tariff]:checked')?.value) || 0;
    const routerCheckbox = document.getElementById('router');
    const router = routerCheckbox.checked ? parseFloat(routerCheckbox.value) : 0;
    const WiFi6 = document.getElementById('WiFi6').checked ? parseFloat(document.getElementById('WiFi6').value) : 0;
    const WiFi6_1 = document.getElementById('WiFi6_1').checked ? parseFloat(document.getElementById('WiFi6_1').value) : 0;
    const WiFi6_2 = document.getElementById('WiFi6_2').checked ? parseFloat(document.getElementById('WiFi6_2').value) : 0;
	const buyRouter2 = document.getElementById('buyRouterYes2').checked ? parseFloat(document.getElementById('buyRouterYes2').value) : 0;
    const buyRouter = document.getElementById('buyRouterYes').checked ? parseFloat(document.getElementById('buyRouterYes').value) : 0;
    const buyRouter3 = document.getElementById('buyRouterYes3').checked ? parseFloat(document.getElementById('buyRouterYes3').value) : 0;
    const buyBox = document.getElementById('buyBoxYes').checked ? parseFloat(document.getElementById('buyBoxYes').value) * quantities.buyBoxYes : 0;
    const buyBox2 = document.getElementById('buyBoxYes2').checked ? parseFloat(document.getElementById('buyBoxYes2').value) * quantities.buyBoxYes2 : 0;
    const buyBox3 = document.getElementById('buyBoxYes3').checked ? parseFloat(document.getElementById('buyBoxYes3').value) * quantities.buyBoxYes3 : 0;
    const buyBox4 = document.getElementById('buyBoxYes4').checked ? parseFloat(document.getElementById('buyBoxYes4').value) * quantities.buyBoxYes4 : 0;
	
	const buyBoxValues = [quantities.buyBoxYes2, quantities.buyBoxYes3, quantities.buyBoxYes, quantities.buyBoxYes4];
	const totalSum = buyBoxValues.reduce((sum, value) => sum + value, 0);
	if (totalSum >= 1 && totalSum <= 20) {
	  multirum = (totalSum - 1) * 50;
	} else if (totalSum > 20) {
	 multirum = (20 - 1) * 50; 
	} else {
	 multirum = totalSum === null || isNaN(totalSum) ? NaN : totalSum;
	}
	
    const serviceRouterBuy = document.getElementById('serviceRouterBuy').checked ? parseFloat(document.getElementById('serviceRouterBuy').value) * quantities.serviceRouterBuy : 0;
    const serviceSetTopBoxBuy = document.getElementById('serviceSetTopBoxBuy').checked ? parseFloat(document.getElementById('serviceSetTopBoxBuy').value) * quantities.serviceSetTopBoxBuy : 0;
	const serviceDeviceInstall = document.getElementById('serviceDeviceInstall').checked ? parseFloat(document.getElementById('serviceDeviceInstall').value) * quantities.serviceDeviceInstall : 0;
	const serviceRouterRent = document.getElementById('serviceRouterRent').checked ? parseFloat(document.getElementById('serviceRouterRent').value) * quantities.serviceRouterRent : 0;
	const serviceRemoteReplace = document.getElementById('serviceRemoteReplace').checked ? parseFloat(document.getElementById('serviceRemoteReplace').value) * quantities.serviceRemoteReplace : 0;
	const serviceEquipmentReplace = document.getElementById('serviceEquipmentReplace').checked ? parseFloat(document.getElementById('serviceEquipmentReplace').value) * quantities.serviceEquipmentReplace : 0;
	const serviceCableInstall = document.getElementById('serviceCableInstall').checked ? parseFloat(document.getElementById('serviceCableInstall').value) * quantities.serviceCableInstall : 0;
	const routerSetup = document.getElementById('RouterSetup').checked ? parseFloat(document.getElementById('RouterSetup').value) : 0;
	const ServisPrise = serviceDeviceInstall + serviceRemoteReplace + serviceEquipmentReplace + serviceCableInstall;
	const ServisPrise2 = serviceRouterBuy + serviceSetTopBoxBuy + serviceRouterRent;
	const ServisPrise4 = serviceRouterRent;
	let startIt = 150
	let selectedTariff = document.querySelector('input[name="tariff"]:checked');
	let data_discount = parseInt(selectedTariff.getAttribute('data-discount')) || 0;
	let discountTarif = parseFloat(selectedTariff.getAttribute('data-discount2')) || 0;
	let isMnpChecked = document.getElementById('MNP').checked;

	let family = parseFloat(document.querySelector('input[name="family"]:checked')?.value) || 0;
	let isFamilySelected = family !== 0;
	let startFamily = isFamilySelected ? 100 : 0;

	const discountDictionary = {
		'tariff7': { data_discount: 4, data_discount2: 525 },
		'tariff1': { data_discount: 4, data_discount2: 425 }
	};

	const discountDictionary2 = {
		'family1': { family: 200 },
		'family2': { family: 400 },
		'family3': { family: 600 },
		'family4': { family: 800 }
	};

	const tariffId = selectedTariff.id;
	if (isMnpChecked && discountDictionary[tariffId]) {
		data_discount = discountDictionary[tariffId].data_discount;
		discountTarif = discountDictionary[tariffId].data_discount2;
		startIt = 0
	}

	let familyId = document.querySelector('input[name="family"]:checked')?.id;
	if (isFamilySelected && isMnpChecked && discountDictionary2[familyId] && discountDictionary[tariffId]) {
		family = discountDictionary2[familyId].family;
		startFamily = 0
	}
	
	const bothRouterAndSetTopBox = serviceRouterBuy > 0 && serviceSetTopBoxBuy > 0;
	const onlyRouterAndSetTopBox = bothRouterAndSetTopBox &&
		serviceDeviceInstall === 0 &&
		serviceRemoteReplace === 0 &&
		serviceEquipmentReplace === 0 &&
		serviceCableInstall === 0;
	const isAnyServiceSelected = [serviceDeviceInstall, serviceRemoteReplace, serviceEquipmentReplace, serviceCableInstall].filter(v => v > 0).length > 1;

	document.getElementById('ServisPrise4').innerText = ServisPrise4 === 0 ? "" : `Аренда : ${ServisPrise4} руб`;

	if (onlyRouterAndSetTopBox) {
		document.getElementById('ServisPrise').innerText = "";
		document.getElementById('ServisPrise2').innerText = `Итого покупка: ${ServisPrise2} руб`;
	} else {
		const servisPriseMessage = (isAnyServiceSelected) ? `Сервисы : ${ServisPrise} руб` : "";
		document.getElementById('ServisPrise').innerText = servisPriseMessage;

		const servisPrise2Message = (bothRouterAndSetTopBox || ServisPrise2 > 4399) ? `Итого покупка : ${ServisPrise2} руб` : "";
		document.getElementById('ServisPrise2').innerText = servisPrise2Message;
	}

	const ServisPrise3 = ServisPrise + ServisPrise2;
	document.getElementById('ServisPrise3').innerText = (ServisPrise === 0 || ServisPrise2 === 0) ? "" : `1 оплата : ${ServisPrise3} руб`;

    let OneFinalPrice, totalPrice, finalPrice;
	
    if (selectedTariff.id === 'tariff3') {
        OneFinalPrice = discountTarif + buyRouter + buyRouter2 + buyRouter3 + routerSetup + startIt;
        totalPrice = tariff + router + WiFi6 + WiFi6_1 + WiFi6_2;
        finalPrice = discountTarif + router + WiFi6 + WiFi6_1 + WiFi6_2;

    } else if (selectedTariff.id === 'tariff2' || selectedTariff.id === 'tariff4') {
        OneFinalPrice = discountTarif + buyRouter + buyRouter2 + buyRouter3 + routerSetup + buyBox + buyBox2 + family + startFamily + startIt;
        totalPrice = tariff + router + WiFi6 + WiFi6_1 + WiFi6_2 + family + buyBox3 + buyBox4;
        finalPrice = discountTarif + router + WiFi6 + WiFi6_1 + WiFi6_2 + family + buyBox3 + buyBox4;

    }
	else if (selectedTariff.id === 'tariff112') {
        OneFinalPrice = discountTarif + buyRouter + buyRouter3 + routerSetup + buyBox + buyBox2 + family + startFamily + multirum + startIt;
        totalPrice = tariff + router + buyBox3 + buyBox4 + WiFi6 + family + multirum;
        finalPrice = discountTarif + router + buyBox3 + buyBox4 + WiFi6 + family + multirum;

    } else {
        OneFinalPrice = discountTarif + buyRouter + buyRouter2 + buyRouter3 + routerSetup + buyBox + buyBox2 + family + startFamily + multirum + startIt;
        totalPrice = tariff + router + buyBox3 + buyBox4 + WiFi6 + WiFi6_1 + WiFi6_2 + family + multirum;
        finalPrice = discountTarif + router + buyBox3 + buyBox4 + WiFi6 + WiFi6_1 + WiFi6_2 + family + multirum;
    }

    document.getElementById('OneFinalPrice').innerText = OneFinalPrice.toFixed(0);
    document.getElementById('finalPrice').innerText = finalPrice.toFixed(0);

    if (totalPrice === finalPrice) {
        document.getElementById('totalPrice').innerText = "";
    } else {
        document.getElementById('totalPrice').innerText = totalPrice.toFixed(0) + " руб";
    }

    const discountEndDateElement = document.getElementById('discountEndDate');

    function getDynamicEndDate(data_discount) {
        const startDate = new Date();
        startDate.setMonth(startDate.getMonth() + data_discount);

        const nextDay = new Date(startDate);
        nextDay.setDate(startDate.getDate() + 1);

        const dayOfWeek = nextDay.getDay();
        if (dayOfWeek === 5) {
            nextDay.setDate(nextDay.getDate() + 2);
        } else if (dayOfWeek === 6) {
            nextDay.setDate(nextDay.getDate() + 1);
        }

        return nextDay;
    }

	function calculateInstallments(totalPrice, router, buyBox3, buyBox4, WiFi6, WiFi6_1, WiFi6_2) {
		const installmentsCheckboxes = document.querySelectorAll('input[type=checkbox][data-installments]');
		let dataInstallments = 0;

		const isThirdTariff = document.getElementById('tariff3').checked;
		const isTariff112 = document.getElementById('tariff112').checked;

		installmentsCheckboxes.forEach(checkbox => {
			if (checkbox.checked) {
				const installmentsValue = parseFloat(checkbox.getAttribute('data-installments')) || 0;
				if (installmentsValue > dataInstallments) {
					dataInstallments = installmentsValue;
				}
			}
		});

		let yearWord;
		if (dataInstallments === 1) {
			yearWord = "год";
		} else if (dataInstallments === 2 || dataInstallments === 3 || dataInstallments === 4) {
			yearWord = "года";
		}

		if (isTariff112) {
			if (router || buyBox3 || buyBox4 || WiFi6) {
				return `через ${dataInstallments} ${yearWord} : ${totalPrice - (router + buyBox3 + buyBox4 + WiFi6)} руб`;
			} else {
				return "";
			}
		} else if (isThirdTariff) {
			if (router || WiFi6 || WiFi6_1 || WiFi6_2) {
				return `через ${dataInstallments} ${yearWord} : ${totalPrice - (router + WiFi6 + WiFi6_1 + WiFi6_2)} руб`;
			} else {
				return "";
			}
		} else {
			if (router || buyBox3 || buyBox4 || WiFi6 || WiFi6_1 || WiFi6_2) {
				return `через ${dataInstallments} ${yearWord} : ${totalPrice - (buyBox3 + buyBox4 + router + WiFi6 + WiFi6_1 + WiFi6_2)} руб`;
			} else {
				return "";
			}
		}
	}

	const installmentsResult = calculateInstallments(totalPrice, router, buyBox3, buyBox4, WiFi6, WiFi6_1, WiFi6_2);
	document.getElementById('installmentsResult').textContent = installmentsResult;

	if (data_discount === 0) {
		discountEndDateElement.innerText = "";
	} else {
		const endDate = getDynamicEndDate(data_discount);
		const options = { day: '2-digit', month: '2-digit', year: 'numeric' };
		const formattedDate = endDate.toLocaleDateString('ru-RU', options);
		
		discountEndDateElement.innerText = `с ± ${formattedDate} : `;
	}
}

function showTooltip2(event, checkboxId) {
    currentCheckboxId = checkboxId;
    const tooltip2 = document.getElementById('tooltip2');
    tooltip2.style.display = 'block';

    const checkboxElement = document.getElementById(checkboxId);
    const rect = checkboxElement.getBoundingClientRect();
    const tooltipWidth = tooltip2.offsetWidth;
    const tooltipHeight = tooltip2.offsetHeight;
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;

    let left = rect.left + window.scrollX;
    let top = rect.bottom + window.scrollY;

    if (left + tooltipWidth > windowWidth + window.scrollX) {
        left = windowWidth + window.scrollX - tooltipWidth;
    }

    if (top + tooltipHeight > windowHeight + window.scrollY) {
        top = rect.top + window.scrollY - tooltipHeight;
    }

    tooltip2.style.left = left + 'px';
    tooltip2.style.top = top + 'px';

    updateTooltipContent2();
    
    setTimeout(() => {
        tooltip2.classList.add('show');
    }, 10);
}

function hideTooltip2() {
    const tooltip = document.getElementById('tooltip2');
    tooltip.classList.remove('show');
}

function increaseQuantity() {
    if (quantities[currentCheckboxId] < 5) {
        quantities[currentCheckboxId]++;
        updateTooltipContent2();
        updateTotalPrice();
    }
}

function decreaseQuantity() {
    if (quantities[currentCheckboxId] > 1) {
        quantities[currentCheckboxId]--;
        updateTooltipContent2();
        updateTotalPrice();
    }
}

function updateTooltipContent2() {
    const selectedValue = getSelectedValue(currentCheckboxId);
    document.getElementById('quantityDisplay2').textContent = quantities[currentCheckboxId];
    document.getElementById('costDisplay2').textContent = selectedValue * quantities[currentCheckboxId];
}

function getSelectedValue(checkboxId) {
    const checkbox = document.getElementById(checkboxId);
    return checkbox.checked ? parseFloat(checkbox.value) : 0;
}

function confirmSelection2() {
    hideTooltip2();
}

function updateTotalPrice() {
calculateTotal();
checkMultirumTooltip();
}

window.onclick = function(event) {
    const tooltip2 = document.getElementById('tooltip2');
    if (event.target == tooltip2 || tooltip2.contains(event.target)) {
        return;
    }
    hideTooltip2();
};

function checkCheckboxes2(event, checkboxId) {
    const checkbox = document.getElementById(checkboxId);
    
    if (checkbox.checked) {
        showTooltip2(event, checkboxId);
        event.stopPropagation();
        quantities[checkboxId] = 1;
        updateTooltipContent2();
        updateTotalPrice();
    } else {
        hideTooltip2();
        quantities[checkboxId] = 0;
        updateTotalPrice();
    }
	}

document.addEventListener('DOMContentLoaded', function () {
    const tooltip = document.getElementById('tooltip');
    const tooltipMotivation = document.getElementById('tooltip-motivation');
    const tooltipPrice = document.getElementById('tooltip-price');
    
    const tooltipOffsetX = 0;
    const tooltipOffsetY = 5;
    const tooltipPositions = {
        right: { lastY: 0 },
        left: { lastY: 0 }
    };
    let hideTimeout = null;

    function hideAllTooltips() {
        tooltip.classList.remove('show');
        tooltipMotivation.classList.remove('show');
        tooltipPrice.classList.remove('show');
        tooltipPositions.right.lastY = 0;
        tooltipPositions.left.lastY = 0;
    }

    function calculatePosition(cursorX, cursorY, tooltipWidth, tooltipHeight) {
        const spaceRight = window.innerWidth - cursorX;
        const spaceLeft = cursorX;
        let direction = 'right';
        
        if (spaceRight < tooltipWidth && spaceLeft >= tooltipWidth) {
            direction = 'left';
        }
        
        const verticalSpace = cursorY - tooltipHeight - tooltipOffsetY;
        const availableSpace = verticalSpace - tooltipPositions[direction].lastY;
        
        if (availableSpace < tooltipHeight) {
            tooltipPositions[direction].lastY = 0;
        }
        
        return {
            left: direction === 'right' 
                ? cursorX + tooltipOffsetX 
                : cursorX - tooltipWidth - tooltipOffsetX,
            top: cursorY - tooltipHeight - tooltipOffsetY - tooltipPositions[direction].lastY,
            direction
        };
    }

    function showTooltip(element, content, tooltipElement, fixedWidth = null, fixedHeight = null) {
        clearTimeout(hideTimeout);
        
        tooltipElement.textContent = content;
		void tooltipElement.offsetWidth;
        const cursorX = element === document.body 
            ? window.innerWidth / 2 
            : element.getBoundingClientRect().left + window.scrollX;
        const cursorY = element === document.body 
            ? window.innerHeight / 2 
            : element.getBoundingClientRect().top + window.scrollY;

        if (fixedWidth) tooltipElement.style.width = `${fixedWidth}px`;
        if (fixedHeight) tooltipElement.style.height = `${fixedHeight}px`;
        
        const tooltipWidth = tooltipElement.offsetWidth;
        const tooltipHeight = tooltipElement.offsetHeight;
        

        const isPriceTooltip = tooltipElement === tooltipPrice;
        const pos = isPriceTooltip 
            ? {
                left: cursorX - tooltipWidth/2,
                top: cursorY - tooltipHeight - tooltipOffsetY,
                direction: 'right'
              }
            : calculatePosition(cursorX, cursorY, tooltipWidth, tooltipHeight);

        tooltipElement.style.left = `${Math.max(0, pos.left)}px`;
        tooltipElement.style.top = `${Math.max(0, pos.top)}px`;
        tooltipElement.classList.add('show');
        
        if (!isPriceTooltip) {
            tooltipPositions[pos.direction].lastY += tooltipHeight + 5;
        }
        
        hideTimeout = setTimeout(() => hideAllTooltips(), 3000);
	}

    document.querySelectorAll('input[name="tariff"]').forEach(radio => {
        radio.addEventListener('click', function() {
            const value = parseFloat(radio.value) || 0;
            const data_discount = parseInt(radio.getAttribute('data-discount')) || 0;
            const discountTarif = parseFloat(radio.getAttribute('data-discount2')) || 0;
            const tariffs = ['tariff3', 'tariff1', 'tariff7'];
            const isThirdTariff = tariffs.includes(radio.id);

            const message = isThirdTariff 
                ? `Цена ${value} руб` 
                : `Цена ${value} руб\nСкидка ${discountTarif} на ${data_discount} м.`;
            
            showTooltip(radio, message, tooltipPrice);
        });
    });

    document.addEventListener('click', function(event) {
        if (!event.target.matches('input[type=checkbox]') && 
            !event.target.matches('input[name="tariff"]')){
            hideAllTooltips();
        }
    });

	document.querySelectorAll('input[type=checkbox]').forEach(checkbox => {
		checkbox.addEventListener('click', function() {
			const value = checkbox.value;
			const installments = checkbox.getAttribute('data-installments');
			const installments2 = checkbox.getAttribute('data-installments2');

			if (checkbox.checked) {
				if (installments === '0') {

					if (installments2) {
						setTimeout(() => {
							showTooltip(checkbox, `Мотивация ${installments2}`, tooltipMotivation, 103, 18);
						}, 50);
					}
				} else {
					showTooltip(checkbox, `${value} на ${installments} г.`, tooltip, 69, 18);
					
					setTimeout(() => {
						if (installments2) {
							showTooltip(checkbox, `Мотивация ${installments2}`, tooltipMotivation, 103, 18);
						}
					}, 50);
				}
			} else {
				hideAllTooltips();
			}
		});
	});
});

let tooltipTimeout;
let activationTime;

function showTooltip3(event, targetElementId, message) {
    const tooltipOk = document.getElementById('tooltipOk');

    if (tooltipTimeout) {
        clearTimeout(tooltipTimeout);
        tooltipTimeout = null;
    }

    document.removeEventListener('click', hideTooltip);
    activationTime = Date.now();
    tooltipOk.style.display = 'block';

    setTimeout(() => {
        tooltipOk.classList.add('show');
    }, 10);
    
    const targetElement = document.getElementById(targetElementId);
    const rect = targetElement.getBoundingClientRect();
    const tooltipWidth = tooltipOk.offsetWidth;
    const tooltipHeight = tooltipOk.offsetHeight;
    const windowWidth = window.innerWidth;
    const windowHeight = window.innerHeight;

    let left = rect.left + window.scrollX;
    let top = rect.bottom + window.scrollY;

    if (left + tooltipWidth > windowWidth + window.scrollX) {
        left = windowWidth + window.scrollX - tooltipWidth;
    }

    if (top + tooltipHeight > windowHeight + window.scrollY) {
        top = rect.top + window.scrollY - tooltipHeight;
    }

    tooltipOk.style.left = left + 'px';
    tooltipOk.style.top = top + 'px';
    tooltipOk.innerText = message;

    tooltipTimeout = setTimeout(hideTooltip, 3000);
    document.addEventListener('click', hideTooltip);
}

function hideTooltip(event) {
    const tooltipOk = document.getElementById('tooltipOk');
    const currentTime = Date.now();

    if (currentTime - activationTime < 1) {
        return;
    }

    tooltipOk.classList.remove('show');
    tooltipTimeout = setTimeout(() => {
        tooltipOk.style.display = 'none';
    }, 300);

    document.removeEventListener('click', hideTooltip);
    if (tooltipTimeout) {
        clearTimeout(tooltipTimeout);
    }
}

function checkMultirumTooltip() {
    const selectedTariff = document.querySelector('input[name=tariff]:checked');
    if (selectedTariff.id === 'tariff2' || selectedTariff.id === 'tariff4') {
        return;
    }

    const buyBoxValues = [
        quantities.buyBoxYes2, 
        quantities.buyBoxYes3, 
        quantities.buyBoxYes, 
        quantities.buyBoxYes4
    ];
    
    const totalSum = buyBoxValues.reduce((sum, value) => sum + value, 0);
    let multirum = 0;

    if (totalSum >= 1 && totalSum <= 20) {
        multirum = (totalSum - 1) * 50;
    } else if (totalSum > 20) {
        multirum = 950;
    }

    if (multirum > 0) {
        let RumMessage = `Мультирум ${multirum} руб`;
        showTooltip3(null, 'finalPrice', RumMessage);
    }
}

document.getElementById('MNP').addEventListener('change', checkMNP);

function checkMNP() {
  const selectedTariff = document.querySelector('input[name=tariff]:checked');
  if (selectedTariff) {
    const isMnpChecked = document.getElementById('MNP').checked;
    if (selectedTariff.id === 'tariff1' || selectedTariff.id === 'tariff7') {
      if (isMnpChecked) {
        const mnpMessage = "0 подкл. Скидка 4 мес\n\nГруппа семья:\n0 созд семьи, 200 - 1 ч";
        showTooltip3(null, 'finalPrice', mnpMessage);
      }
    } else if (selectedTariff.id === 'tariff3' || selectedTariff.id === 'tariff112' || selectedTariff.id === 'tariff2' || selectedTariff.id === 'tariff4') {
      const mnpMessage = "скидка не распространяется\nна эти тарифы: 112, 3, 2, 4";
      showTooltip3(null, 'finalPrice', mnpMessage);
    }
  }
}

document.getElementById('tariff112').addEventListener('change', function() {
    if (this.checked) {
        check112();
    }
});

function check112() {
	const mnpMessage = "Входит новый роутер 5G!";
    showTooltip3(null, 'finalPrice', mnpMessage);
    }
	
document.getElementById('tariff3').addEventListener('change', function() {
    if (this.checked) {
        check3();
    }
});

function check3() {
	const mnpMessage = "Не входят приставки";
    showTooltip3(null, 'finalPrice', mnpMessage);
    }

function toggleSpoiler(header) {
    const spoiler = header.parentElement;
    const content = spoiler.querySelector('.spoiler-content');
    const footer = spoiler.querySelector('.spoiler-footer');
    const icon = header.querySelector('.spoiler-icon');

    if (content.classList.contains('show')) {
    content.style.maxHeight = content.scrollHeight + 'px';    
    icon.classList.remove('rotate');
    setTimeout(() => {
        content.style.maxHeight = '0';
    }, 2);
    
    content.classList.remove('show');
    footer.classList.remove('show');
    icon.textContent = '+';
	} else {
		content.style.maxHeight = content.scrollHeight + 'px';		
		icon.classList.add('rotate');
		content.classList.add('show');
		footer.classList.add('show');
		icon.textContent = '-';

		content.addEventListener('transitionend', () => {
			footer.scrollIntoView({
				behavior: 'smooth',
				block: 'end'
			});
		}, { once: true });
	}

    content.addEventListener('transitionend', () => {
        if (!content.classList.contains('show')) {
            content.style.maxHeight = null;
        } else {
            content.style.maxHeight = 'none';
        }
    }, { once: true });
}

const radioButtons = document.querySelectorAll('input[type=radio]');
radioButtons.forEach(radio => {
    radio.addEventListener('change', calculateTotal);
});

const checkboxes = document.querySelectorAll('input[type=checkbox]');
checkboxes.forEach(checkbox => {
    checkbox.addEventListener('change', calculateTotal);
});

calculateTotal();
</script>
</body>
	
</html>
